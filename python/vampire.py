#!/usr/bin/python3
from collections import namedtuple

# rules for each generation
Generation = namedtuple('Generation', ['number', 'blood_pool', 'stat_max', 'blood_per_turn'])
default_generation = 13
generation_rules = {
  1:  Generation(number=1,  blood_pool=500, stat_max=10, blood_per_turn=50), 
  2:  Generation(number=2,  blood_pool=250, stat_max=10, blood_per_turn=20), 
  3:  Generation(number=3,  blood_pool=100, stat_max=10, blood_per_turn=15), 
  4:  Generation(number=4,  blood_pool=50,  stat_max=9,  blood_per_turn=10), 
  5:  Generation(number=5,  blood_pool=40,  stat_max=8,  blood_per_turn=8), 
  6:  Generation(number=6,  blood_pool=30,  stat_max=7,  blood_per_turn=6), 
  7:  Generation(number=7,  blood_pool=20,  stat_max=6,  blood_per_turn=4), 
  8:  Generation(number=8,  blood_pool=15,  stat_max=5,  blood_per_turn=3), 
  9:  Generation(number=9,  blood_pool=14,  stat_max=5,  blood_per_turn=2), 
  10: Generation(number=10, blood_pool=13,  stat_max=5,  blood_per_turn=1), 
  11: Generation(number=11, blood_pool=12,  stat_max=5,  blood_per_turn=1), 
  12: Generation(number=12, blood_pool=11,  stat_max=5,  blood_per_turn=1), 
  13: Generation(number=13, blood_pool=10,  stat_max=5,  blood_per_turn=1), 
  14: Generation(number=14, blood_pool=10,  stat_max=5,  blood_per_turn=1), 
  15: Generation(number=15, blood_pool=10,  stat_max=5,  blood_per_turn=1)
}

# abilities
Ability = namedtuple('Ability', ['name', 'type', 'levels', 'description'])
abilities = [   
  Ability(
    name='Alertness',
    type='talents',
    levels= [
      'Novice: You’re no mindless drone.',
      'Practiced: Habitual eavesdropper.',
      'Competent: You keep a sharp eye on your surroundings.',
      'Expert: Whether from paranoia or good sense, you are rarely caught off-guard.',
      'Master: Your senses are on par with those of a wild animal.'
    ],
    description='This is your basic knack for noticing things that go on around you, even when you’re not actively looking for them. Alertness describes the attention you pay to the outside world, whether otherwise occupied or not. This Talent is typically paired with Perception, and is best used when sensing physical stimuli (as opposed to moods or clues).\n_Possessed by_: Hunters, Bodyguards, Security Personnel, Journalists, Burglars\n_Specialties_: Noises, Eavesdropping, Fine Details, Hidden Weapons, Crowds, Forests, Animals'),
  Ability(
    name='Athletics',
    type='talents',
    levels= [
      'Novice: You had an active childhood.',
      'Practiced: High-school athlete',
      'Competent: Talented lifelong amateur.',
      'Expert: Professional athlete.',
      'Master: Olympic medalist.'
    ],
    description='This Talent represents your basic athletic ability, as well as any training you might have had in sports or other rigorous activities. Athletics concerns all forms of running, jumping, throwing, swimming, sports, and the like. However, Athletics doesn’t cover basic motor actions such as lifting weights, nor does it govern athletic feats covered by another Ability (such as Melee).\n_Possessed by_: Athletes, Hobbyists, Park Rangers, Jocks, Kids\n_Specialties_: Swimming, Rock Climbing, Acrobatics, Dancing, Parkour, specific sports'),
  Ability(
    name='Awareness',
    type='talents',
    levels= [
      'Novice: Once in a while, you get the feeling that something isn’t right.',
      'Practiced: You sometimes get strange vibes from a particular direction or vague area (like a building).',
      'Competent: You can walk into a room and know that something unusual is going on within.',
      'Expert: If you concentrate, you can sense whether a someone in a group of people or a collection of objects is supernatural.',
      'Master: You instinctually know if something or someone is mundane or supernatural.'
    ],
    description='Awareness is an instinctual reaction to the presence of the supernatural. It differs from Alertness (which measures sensitivity to mundane events) and Occult (which covers actual knowledge about the supernatural). Usually, only supernatural creatures have access to this particular Talent, but some unique mortals have a sense that something is strange in the world (such as those with True Faith - see p. 372). Characters with Awareness sometimes get hunches, chills or sudden flashes of inspiration when they are near supernatural creatures, objects or events. This insight is purely subconscious, and knowing that something’s wrong doesn’t mean that the character knows what it is. To get more specific information, the Kindred will need to use Occult or a particular power - Awareness only makes the vampire more receptive to the presence of the unusual. A vampire can use Awareness deliberately if he suspects that something is supernatural, but more often the Storyteller can ask for an Awareness roll to determine whether a vampire notices a strange event that’s not immediately visible.\n_Possessed by_: Psychics, New Agers, Mystics, Paranormal Researchers\n_Specialties_: Ghostly Activity, Mystical Objects, Someone’s In My Head, Debunking'),
  Ability(
    name='Brawl',
    type='talents',
    levels= [
      'Novice: You were picked on as a kid.',
      'Practiced: You’ve participated in the occasional bar-room tussle.',
      'Competent: You’ve fought regularly and routinely, and generally walked away in better shape than your opponents.',
      'Expert: You could be a serious contender on the MMA circuit.',
      'Master: Somewhere on the Internet, there’s a video of you taking down three men in four seconds.'
    ],
    description='The Brawl Talent represents how well you fight in tooth-and-nail situations. This Talent represents skill in unarmed combat, whether from formal martial arts training or simply from plenty of experience. Effective brawlers are coordinated, resistant to pain, quick, strong and mean. The willingness to do whatever it takes to hurt your opponent wins plenty of fights.\n_Possessed by_: Military, Police, Roughnecks, Thugs\n_Specialties_: Dirty Fighting, Strikes, Throws, Submission Holds, specific martial arts or combat styles'),
  Ability(
    name='Empathy',
    type='talents',
    levels= [
      'Novice: You lend the occasional shoulder to cry on.',
      'Practiced: You can sometimes literally feel someone else’s suffering.',
      'Competent: You have a keen insight into other people’s motivations.',
      'Expert: It’s almost impossible to lie to you.',
      'Master: The human soul conceals no mysteries from you.'
    ],
    description='You understand the emotions of others, and can sympathize with, feign sympathy for or play on such emotions as you see fit. You are adept at discerning motive, and might be able to discern when someone’s lying to you. However, you may be so in tune with other people’s feelings that your own emotions are affected.\n_Possessed by_: Social Workers, Parents, Actors, Psychologists, Detectives, Seducers, Mediums, Best Friends\n_Specialties_: Emotions, Insight, Motives, Gaining Trust'),
  Ability(
    name='Expression',
    type='talents',
    levels= [
      'Novice: Your talent has matured past crude poetry on notebook paper.',
      'Practiced: You could lead a college debate team.',
      'Competent: You could be a successful writer.',
      'Expert: Your work is Pulitzer material.',
      'Master: Steve Jobs asks you for input on his next mobile device.'
    ],
    description='This is your ability to get your point across clearly, whether through conversation, poetry or even in 140 characters or fewer. Characters with high Expression can phrase their opinions or beliefs in a manner that cannot be ignored (even if their opinions are misinformed or worthless). They might also be talented actors, skilled at conveying moods or communicating emotion with every gesture. Additionally, this Talent represents your ability for poetry, creative writing or other literary art forms. For many elders, Expression is the subtle art of crafting a satirical epigram capable of socially crippling one’s longtime rival. For younger Kindred, Expression may well be the key to convincing thirty stake-wielding Anarchs to converge on the Sheriff’s private hunting ground with the right text message. You can choose a specialty in Expression, even at less than 4 dots.\n_Possessed by_: Actors, Writers, Poets, Politicians, Journalists, Web Personalities, Rabble-Rousers\n_Specialties_: Acting, Poetry, Fiction, Impromptu, Conversation, Social Media'),
  Ability(
    name='Intimidation',
    type='talents',
    levels= [
      'Novice: Shady teenager',
      'Practiced: Skinhead thug',
      'Competent: Drill sergeant',
      'Expert: Your air of authority cows casual passersby.',
      'Master: You can frighten off vicious animals.'
    ],
    description='Intimidation takes many forms, from outright threats and physical violence to mere force of personality. It needn’t be course or callous, and a well-placed intimidating word under the right circumstances might well be called “diplomacy” in certain circles. You know the right method for each occasion, and can be very ... persuasive.\n_Possessed by_: Bullies, Anonymous, Military Officers, Bouncers, Gangsters, Sabbat\n_Specialties_: Veiled Threats, Pulling Rank, Physical Coercion, Blackmail, Internet'),
  Ability(
    name='Leadership',
    type='talents',
    levels= [
      'Novice: Captain of your Little League team',
      'Practiced: Student body president',
      'Competent: An effective CEO',
      'Expert: Presidential material',
      'Master: You could be beloved dictator of a nation.'
    ],
    description='You are an example to others and can inspire them to do what you want. Leadership has less to do with manipulating people’s desires than it does with presenting yourself as the sort of person they want to follow. Anyone can lead a group into some sort of confict; a good leader can get them back out intact. This Talent is usually paired with Charisma rather than Manipulation.\n_Possessed by_: Politicians, Princes, Managers, Executives, Military Officers, Police\n_Specialties_: Oratory, Compelling, Friendly, Open, Noble, Military, Multimedia'),
  Ability(
    name='Streetwise',
    type='talents',
    levels= [
      'Novice: You know who’s holding.',
      'Practiced: You’re accorded respect on the street.',
      'Competent: You could head your own gang.',
      'Expert: You have little to fear in even the worst neighborhoods.',
      'Master: If you haven’t heard it, it hasn’t been said.'
    ],
    description='The streets can provide a lot of information or money to those who know the language. Streetwise allows you to blend in unobtrusively with the local scene, pick up gossip, understand slang or even dabble in criminal doings.\n_Possessed by_: Criminals, Homeless People, Reporters, Clubgoers, Savvy Detectives, Neonates\n_Specialties_: Fencing, Illegal Drugs, Illegal Weapons, Free Wifi, Gangs, Being On the Guest List, Local Slang'),
  Ability(
    name='Subterfuge',
    type='talents',
    levels= [
      'Novice: You tell the occasional white lie.',
      'Practiced: Vampire',
      'Competent: Criminal lawyer',
      'Expert: Deep-cover agent',
      'Master: You’re the very last person anyone would suspect.'
    ],
    description='You know how to conceal your own motives and project what you wish. Furthermore, if you can root out other people’s motives, you can then use those motives against them. This Talent defines your talent for intrigue, secrets, and double-dealing. Mastery of Subterfuge can make you the ultimate seducer or a brilliant spy.\n_Possessed by_: Politicians, Lawyers, Vampires, Teenagers, Con Men, Pick-up Artists\n_Specialties_: Seduction, Impeccable Lies, Feigning Mortality, the Long Con'),
  Ability(
    name='Animal_Ken',
    type='skills',
    levels= [
      'Novice: You can get a domesticated horse to let you pet it.',
      'Practiced: You can housebreak a puppy.',
      'Competent: You could train a seeing eye dog.',
      'Expert: Circus trainer',
      'Master: You can tame wild beasts without benefit of supernatural powers.'
    ],
    description='You can understand animals’ behavior patterns. This Skill allows you to predict how an animal might react in a given situation, train a domesticated creature or even try to calm or enrage animals.\n_Possessed by_: Farmers, Animal Trainers, Zookeepers, Veterinarians, Pet Owners, Domitors\n_Specialties_: Dogs, Attack Training, Big Cats, Horses, Farm Animals, Falconry'),
  Ability(
    name='Crafts',
    type='skills',
    levels= [
      'Novice: High school wood shop',
      'Practiced: You’re starting to develop your own style.',
      'Competent: You could start your own shop.',
      'Expert: You wrote instruction manuals on your field of specialization.',
      'Master: Your craftsmanship and insight is virtually without peer.'
    ],
    description='This Skill covers your ability to make or fix things with your hands. Crafts allows you to work in fields such as carpentry, leather-working, weaving or even mechanical expertise such as car repair. You can even create lasting works of art with this Skill, depending on the number of successes you achieve. You must always choose a specialization in Crafts, even though you retain some skill in multiple fields.\n_Possessed by_: Mechanics, Artisans, Artists, Designers, Inventors, Back-to-the-Land Types\n_Specialties_: Pottery, Sewing, Home Repair, Carpentry, Appraisal, Carburetors'),
  Ability(
    name='Drive',
    type='skills',
    levels= [
      'Novice: You know how to work an automatic transmission.',
      'Practiced: You can drive a stick shift.',
      'Competent: Professional trucker',
      'Expert: NASCAR daredevil or tank pilot',
      'Master: Whether it’s a Fiat or a Ferrari, you can make it sing.'
    ],
    description='You can drive a car, and maybe other vehicles as well. This Skill does not automatically entail familiarity with complicated vehicles such as tanks or 18-wheelers, and difficulties may vary depending on your experience with individual automobiles. After all, helming a station wagon doesn’t prepare you for double-clutching a Maserati at 100 miles per hour.\n_Possessed by_: Cabbies, Truckers, Race Car Drivers, Automotive Show Hosts, Rebels\n_Specialties_: Off-Road, Motorcycles, High Speed, Heavy Traffic, Avoiding Traffic Cops'),
  Ability(
    name='Etiquette',
    type='skills',
    levels= [
      'Novice: You know when to keep your mouth shut.',
      'Practiced: You’ve been to a black-tie event or two.',
      'Competent: You know your way around even obscure silverware.',
      'Expert: Her Majesty would consider you charming.',
      'Master: If the right people came to dinner, you could end wars - or start them.'
    ],
    description='You understand the nuances of proper behavior, in both mortal society and Kindred culture. In many cases, knowing how to broach a topic is as important as the discussion itself, and a person with poor etiquette will never have an opportunity to make herself heard because she doesn’t know when or how to interject.This Skill is used during meetings, haggling, seduction, dancing, dinner etiquette and all forms of diplomacy.\n_Possessed by_: Diplomats, Travelers, High Society, Executives, Kindred of Status\n_Specialties_: At Elysium, Business, High Society, Sabbat Protocol'),
  Ability(
    name='Firearms',
    type='skills',
    levels= [
      'Novice: You had a BB gun as a kid.',
      'Practiced: You while away the occasional hour at the gun club.',
      'Competent: You’ve survived a firefight or two.',
      'Expert: You could pick off people for a living.',
      'Master: You’ve been practicing since the debut of the Winchester.'
    ],
    description='Executing a mortal with a sword starts investigations. Clawing someone to ribbons tears the edges of the Masquerade. So Cainites adapt, and many have devoted their energies to learning how to kill with guns. This Skill represents familiarity with a range of firearms, from holdout pistols to heavy machine guns. Further, someone skilled in Firearms can clean, repair, recognize and accurately fire most forms of small arms. This Skill is also used to unjam guns (Wits + Firearms).\n_Possessed by_: Anarchs, Neonates, Policemen, Military Personnel, Survivalists, Hunters\n_Specialties_: Fast-Draw, Gunsmithing, Pistols, Marksmanship, Revolvers, Shotguns'),
  Ability(
    name='Larceny',
    type='skills',
    levels= [
      'Novice: You can pick a simple lock.',
      'Practiced: You could run a shell game hustle on the corner.',
      'Competent: You can open a standard locked window from the outside.',
      'Expert: You can “retool” a passport or ID card.',
      'Master: You could get into (or out of) a multinational bank’s central vault.'
    ],
    description='This Skill entails familiarity with the tools and techniques for the sorts of physical manipulation typically associated with criminal activity. Picking locks, manual forgery, safecracking, simple hot-wiring, various forms of breaking and entering, and even sleight-of-hand all fall under the auspices of Larceny. Larceny is useful not only for theft, but also for setting up “the unbeatable system” or deducing where a thief broke in. This skill does not confer any aptitude with advanced security or anti-crime technologies such as video surveillance or alarm systems - those are covered by the Technology Knowledge.\n_Possessed by_: Burglars, Security Consultants, Policemen, Car Thieves, Street Magicians\n_Specialties_: Safecracking, Misdirection, Lockpicking, Hotwiring, Pickpocketing'),
  Ability(
    name='Melee',
    type='skills',
    levels= [
      'Novice: You know the right way to hold a knife.',
      'Practiced: You may have been in the occasional street fight.',
      'Competent: You could make a college fencing team.',
      'Expert: You could keep order in the Prince’s court.',
      'Master: Your enemies would rather face a SWAT team than your blade.'
    ],
    description='As the Kindred maxim runs, “Guns mean nothing to a lifeless heart”. A blade is often worth far more, as is the skill to use it properly. Melee covers your ability to use hand-to-hand weapons of all forms, from swords and clubs to esoteric martial-arts paraphernalia such assai or nunchaku. And, of course, there is always the utility of the wooden stake ... \n_Possessed by_: Assassins, Gang Members, Martial Artists, Police, Duelists\n_Specialties_: Knives, Swords, Improvised Weaponry, Riposte, Disarms'),
  Ability(
    name='Performance',
    type='skills',
    levels= [
      'Novice: You could sing in the church choir.',
      'Practiced: Your Internet videos have over a hundred thousand views.',
      'Competent: You almost always have a gig booked.',
      'Expert: You have the talent to be a national sensation.',
      'Master: You are a virtuoso without peer.'
    ],
    description='The Performance Skill governs your ability to perform artistic endeavors such as singing, dancing, acting, or playing a musical instrument. You are almost certainly specialized in one field, although true virtuosos may be talented in many forms of performance. This Skill represents not only technical know-how, but the ability to work an audience and enrapture them with your show. As with Crafts, you must choose a specialty, even though this Skill also imparts a general sense for watching and responding to your audience’s mood regardless of medium.\n_Possessed by_: Musicians, College Students, Actors, Ballerinas, Mimes\n_Specialties_: Dancing, Singing, Rock and Roll, Acting, Guitar Solos, Drunken Karaoke'),
  Ability(
    name='Stealth',
    type='skills',
    levels= [
      'Novice: You can hide in a darkened room.',
      'Practiced: You can shadow someone from streetlight to streetlight.',
      'Competent: You have little difficulty finding prey from evening to evening.',
      'Expert: You can move quietly over dry leaves.',
      'Master: Nosferatu elder'
    ],
    description='This Skill is the ability to avoid being detected, whether you’re hiding or moving at the time. Stealth is often tested against someone else’s Perception + Alertness. This Ability is, for obvious reasons, highly useful in stalking prey. In many cases, Stealth is also used to conceal items, whether on one’s person or somewhere in the environment.\n_Possessed by_: Burglars, Assassins, Kindred, Spies, Reporters, Commandos\n_Specialties_: Hiding, Silent Movement, Shadowing, Crowds'),
  Ability(
    name='Survival',
    type='skills',
    levels= [
      'Novice: You can survive a night spent outside.',
      'Practiced: You’ve “roughed it” on a regular basis.',
      'Competent: You can separate poison or spoilage from edible forage.',
      'Expert: You could live for months in the challenging environment of your choice.',
      'Master: You could get dropped naked into the Andes and do all right for yourself.'
    ],
    description='Although vampires have little to fear from starvation and exposure, the wilderness can still be dangerous to a Cainite. This Skill allows you to find shelter, navigate your way to civilization, track prey, establish a makeshift haven and possibly even avoid supernatural threats like werewolves that also prowl the World of Darkness. Note that Survival need not be used only in areas considered “wilderness”. There’s plenty of Survival that goes into getting by in various parts of modern cities.\n_Possessed by_: Scouts, Soldiers, Outdoors Enthusiasts, Survivalists, Hunters\n_Specialties_: Tracking, Woodlands, Jungle, StreetLife, Hunting, Urban Exploration'),
  Ability(
    name='Academics',
    type='knowledges',
    levels= [
      'Student: You’re aware that 1066 isn’t a Beverly Hills area code.',
      'College: You can quote from the classics, identify major cultural movements and expound on the difference between Ming and Moghul.',
      'Masters: You could get a paper published in a scholarly journal.',
      'Doctorate: Professor emeritus',
      'Scholar: Scholars worldwide acknowledge you as one of the foremost experts of your time.'
    ],
    description='This catchall Knowledge covers the character’s erudition in the humanities: literature, history, art, philosophy and other “liberal” arts and sciences. A character with dots in Academics is generally well rounded in these fields, and at high levels may be considered an expert in one or more areas of study. Not only can this Knowledge impress at salons and other Elysium functions, but it can also offer valuable clues to certain past- and future - movements in the Jyhad. If you like, you can choose a specialty for Academics even at less than 4 dots.\n_Possessed by_: Professors, Literati, Topical Bloggers, Elders\n_Specialties_: Post-structuralism, Impressionist Painting, Imperial Rome, Color Theory, Linguistics'),
  Ability(
    name='Computers',
    type='knowledges',
    levels= [
      'Student: You can navigate touchscreen and traditional point-and-click GUIs.',
      'College: You know your way around various applications and the Internet.',
      'Masters: You know what to do with a text command prompt.',
      'Doctorate: You can make a very comfortable living as a consultant.',
      'Scholar: You have all the SDKs and comprehend data structures for a stunning variety of programming languages.'
    ],
    description='This Knowledge represents the ability to operate and program computers, including mobile devices. Most Computer use also imparts a degree of Internet awareness (if not savvy).\n_Possessed by_: Hackers, Office Workers, Programmers, Data Processors, Students\n_Specialties_: “The YouTubes”, Computer Languages, Internet, Database Administration, HCI, Viruses, specific devices and programs'),
  Ability(
    name='Finance',
    type='knowledges',
    levels= [
      'Student: You’ve taken a few business classes.',
      'College: You have some practical experience and can keep your books fairly neat.',
      'Masters: You’d make a fine stockbroker.',
      'Doctorate: Corporations follow your financial lead.',
      'Scholar: You could turn a $20 bill into a fortune.'
    ],
    description='You know the ins and outs of commerce, from evaluating an item’s relative worth to keeping up with currency exchange rates. This Knowledge can be invaluable when brokering items, running numbers, or playing the stock market. Sufficiently high levels in Finance allow you to raise your standards of living to a very comfortable level.\n_Possessed by_: Executives, Upper Class, Stockbrokers, Accountants, Fences, Drug Dealers, Smugglers\n_Specialties_: Stock Market, Laundering, Appraisal, Foreign Currencies, Accounting, Fencing, Corporations, Federal Bailouts'),
  Ability(
    name='Investigation',
    type='knowledges',
    levels= [
      'Student: You can parse a broad Web search for clues.',
      'College: Police officer',
      'Masters: Private detective',
      'Doctorate: Federal agent',
      'Scholar: Sherlock Holmes'
    ],
    description='You’ve learned to notice details others might overlook, and might make an admirable detective. This Knowledge represents not only a good eye for detail, but also an ability to do research and follow leads. Such research may include Internet searches or more specific research techniques like hitting the law books and periodicals archives at the library.\n_Possessed by_: Detectives, Mystery Buffs, Policemen, Stalkers\n_Specialties_: Forensics, Shadowing, Search, Discolorations, Database Research'),
  Ability(
    name='Law',
    type='knowledges',
    levels= [
      'Student: You’ve paid a traffic ticket and know whether to plead guilty, not guilty or nolo contendere next time.',
      'College: You’re either studying for or just passed the bar exam.',
      'Masters: You can make a living of the practice, and probably do.',
      'Doctorate: If you’re not partner yet, you will be soon.',
      'Scholar: You could find the loopholes in the Devil’s contracts.'
    ],
    description='The Law Knowledge represents a knowledge of both legal statutes and proper procedures for enforcing them. Law can be useful for filing suits, avoiding lawsuits or getting out of jail. What’s more, the Kindred keep their own laws, and more than one vampire has saved his own unlife by deftly exploiting a loophole in one of the Traditions. The Law Knowledge has anynumber of specialties, and a player may choose one for her character when she takes this Ability, representing both her field of experience and a general sense for how the legal system (especially in her locality) functions, though this is not mandatory.\n_Possessed by_: Lawyers, Police, Judges, Detectives, Legislators\n_Specialties_: Criminal, Suits, Courtroom Protocol, Contracts, Police Procedure, the Traditions, the Code of Milan'),
  Ability(
    name='Medicine',
    type='knowledges',
    levels= [
      'Student: You’ve taken a CPR course.',
      'College: Premed or paramedic',
      'Masters: General practitioner',
      'Doctorate: You can perform transplants.',
      'Scholar: You are respected by the world’s medical community as a pioneer.'
    ],
    description='You have an understanding of how the human body - and to a lesser extent the vampiric body - works. This Ability covers knowledge of medicines, ailments, first-aid procedures, and diagnosis or treatment of disease. Medicine is of great use to those Kindred with an interest in repairing, damaging, or reworking the human body.\n_Possessed by_: Med Students, Doctors, Lifeguards, Parents, Paramedics, Tzimisce\n_Specialties_: Organ Transplants, Emergency Care, Poison Treatments, Pathology, Pharmaceuticals, the Kindred Condition'),
  Ability(
    name='Occult',
    type='knowledges',
    levels= [
      'Student: You’ve got a blog about the eerie and the disturbing.',
      'College: There seems to be some unsettling truth to some of the rumors you’ve heard.',
      'Masters: You’ve heard a lot and actually seen a little for yourself.',
      'Doctorate: You can recognize blatantly false sources and make educated guesses about the rest.',
      'Scholar: You know most of the basic truths about the hidden world.'
    ],
    description='You are knowledgeable in occult areas such as mysticism, curses, magic, folklore, and particularly vampire lore. Unlike most other Knowledges, Occult does not imply a command of hard facts. Much of what you know may well be rumor, myth, speculation, or hear-say. However, the secrets to be learned in this field are worth centuries of sifting legend from fact. High levels of Occult imply a deep understanding of vampire lore, as well as a good grounding in other aspects of the occult. At the very least, you can discern what is patently false.\n_Possessed by_: Occultists, The Superstitious, New Agers, Tremere\n_Specialties_: Kindred Lore, Rituals, Infernalism, Witches, Noddist Lore'),
  Ability(
    name='Politics',
    type='knowledges',
    levels= [
      'Student: Activist; you can pay a speeding ticket online.',
      'College: Political science major; you know how to file a request for information.',
      'Masters: Campaign manager or talk-radio host; the clerk will help you navigate the forms you need to complete and tell you who needs the duplicates.',
      'Doctorate: Senator; “We’re not supposed to show this to anyone without press credentials, so don’t quote me.”',
      'Scholar: You could choose the next President of the United States. “Sure, here are the keys to the file morgue. Turn off the light when you leave.”'
    ],
    description='You are familiar with the politics of the moment, including the people in charge and how they got there. This Knowledge can aid you in dealing with or influencing mortal politicians, or even offer some insight into the local Cainite power structure. The Politics Knowledge includes the ability to practically navigate various bureaucracies, as it assumes that certain organizational structures and relationship currencies are universal.\n_Possessed by_: Activists, Politicians, Lawyers, vampires of all sorts\n_Specialties_: City, State, Federal, Bureaucracy, Dogma, Radical, Camarilla'),
  Ability(
    name='Science',
    type='knowledges',
    levels= [
      'Student: You know most of the high-school basics.',
      'College: You’re familiar with the major theories.',
      'Masters: You could teach high-school science.',
      'Doctorate: You’re fully capable of advancing the knowledge in your field.',
      'Scholar: Your Nobel Prize is waiting for you.'
    ],
    description='You have at least a basic understanding of most of the physical sciences, such as chemistry, biology, physics and geology. This Knowledge can be put to all forms of practical use. In most cases, a player should select a specialty to refect a focus for her character’s scientific studies, but this isn’t strictly necessary.\n_Possessed by_: Scientists, Students, Researchers, Teachers, Engineers, Technicians, Pilots\n_Specialties_: Chemistry, Biology, Geology, Physics, Astronomy'),
  Ability(
    name='Technology',
    type='knowledges',
    levels= [
      'Student: You can perform simple modifications or repairs.',
      'College: You could make your living in assembly or repair.',
      'Masters: You can design new technologies from a set of objective requirements.',
      'Doctorate: For you, it’s not, “Can this be done?” but “How can this be done?”',
      'Scholar: A visionary in the field; you shape how people interact with their world through devices.'
    ],
    description='The Technology Knowledge represents a broad acumen with electronics, computer hardware, and devices more elaborate than “machines”, which fall under the Crafts Skill. If it has a processor, a transistor or an integrated circuit - if it’s electronic rather than electrical - manipulating it uses the Technology Knowledge. This is the wide-ranging Ability used to build one’s own computer, install (or subvert) a security system, repair a mobile phone or kit-bash a shortwave radio. You must always choose a specialization in Technology, even though you possess some skill in multiple fields.\n_Possessed by_: Engineers, Scientists, Defense Contractors, the Cable Guy\n_Specialties_: Telecom, Computers, Security, Communications, Improvised Solutions, Industrial Espionage')
]
#abilities = dict((ability.name.lower(), ability) for ability in abilities)


class BoundedInt(property):
  """
  * This class behaves like a int property, which is checked against the lower and upper bound
  """
  def __init__(self, lower, upper, doc=None):
    property.__init__(self, self.fget, self.fset, doc=doc)
    self.min = lower
    self.max = upper
    self._value = lower

  def fget(self, container):
    return self._value

  def fset(self, container, v):
    if (self.min and v < self.min) or (self.max and v > self.max):
      raise ValueError("{} is out of bounds! [{},{}]".format(v, self.min, self.max))
    self._value = v

class CharacterAttribute(BoundedInt):
  def __init__(self, doc=None):
    BoundedInt.__init__(self, 1, None, doc)

  def fset(self, vampire, value):
    if value > vampire.stat_max:
      raise ValueError("{} is to high for attribute!".format(value))
    BoundedInt.fset(self, vampire, value)
    

class Vampire(object):
  class Abilities(object):
    """
    * This class contains all of the characters abilities
    * and provides some helper functions.
    * 
    """
    def __init__(self, atype=None, parent=None):
      self.talents     = Vampire.Talents()
      self.skills      = Vampire.Skills()
      self.knowledges  = Vampire.Knowledges()

      for ability in abilities:
        key = ability.name.lower()
        prop = BoundedInt(0, 5)
        setattr(Vampire.Abilities, key, prop)
        
        if ability.type == 'talents':
          setattr(Vampire.Talents, key, prop)
        if ability.type == 'skills':
          setattr(Vampire.Skills, key, prop)
        if ability.type == 'knowledges':
          setattr(Vampire.Knowledges, key, prop)

    def __iter__(self):
      for ability in abilities:
        value = getattr(self, ability.name.lower())
        if value > 0:
          yield (ability, value)

    def __get_item__(self, ability):
      return getattr(self, ability.name.lower())

    def __setitem__(self, ability, value):
      key = ability.name.lower()
      if not ability in abilities or not hasattr(self, key):
        raise ValueError("Unknown ability!")  
      setattr(self, key, value)


  class Skills(object):
    def __iter__(self):
      for ability in abilities:
        if ability.type == 'skills':
          value = getattr(self, ability.name.lower())
          if value > 0:
            yield (ability, value)

  class Talents(object):
    def __iter__(self):
      for ability in abilities:
        if ability.type == 'talents':
          value = getattr(self, ability.name.lower())
          if value > 0:
            yield (ability, value)

  class Knowledges(object):
    def __iter__(self):
      for ability in abilities:
        if ability.type == 'knowledges':
          value = getattr(self, ability.name.lower())
          if value > 0:
            yield (ability, value)

  # ---------------------------------------------------------  

  attributes = [
    'strength', 'dexterity', 'stamina', 
    'charisma', 'manipulation', 'appearance',
    'perception', 'intelligence', 'wits'
  ]

  # virtues
  conscience   = BoundedInt(1, 5, "Conscience of your Character")
  self_control = BoundedInt(1, 5, "Self-control of your Character")
  courage      = BoundedInt(1, 5, "Courage of your Character")


  def __init__(self, *kwargs):
    self._generation     = default_generation
    for attr in Vampire.attributes:
      setattr(Vampire, attr, CharacterAttribute(attr + " of your character"))

    self._humanity       = 0
    self._willpower      = 0
    self._blood_pool     = 0
    self._blood_pool_max = 0

    self.abilities   = Vampire.Abilities()
    self.disciplines = []
    self.backgrounds = []

  @property
  def stat_max(self):
    return generation_rules[self.generation].stat_max

  @property
  def blood_per_turn(self):
    return generation_rules[self.generation].blood_per_turn

  @property
  def blood_pool_max(self):
    return generation_rules[self.generation].blood_pool

  @property
  def blood_pool(self):
    return self._blood_pool

  @blood_pool.setter
  def blood_pool(self, value):
    if value > self.blood_pool_max:
      raise ValueError("Not enough blood capacity! {} > {}".format(value, self.blood_pool_max))
    elif value < 0:
      raise ValueError("Negative blood pool is impossible!")
    self._blood_pool = value

  @property
  def generation(self):
    return self._generation

  @generation.setter
  def generation(self, value):
    """Set generation of vampire and adjust all stats, that are too high"""
    self._generation = value

    for attr in Vampire.attributes:
      setattr(self, attr, min(getattr(self, attr), self.stat_max))

    self.blood_pool = min(self.blood_pool_max, self.blood_pool)




